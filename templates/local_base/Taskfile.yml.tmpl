#  -----------------------------------------------------------------------------
#  Taskfile — Developer Commands for `{{.ProjectName}}`
#  -----------------------------------------------------------------------------
#
#  This file defines reproducible and documented task aliases for common workflows.
#  It is used by the `go-task` tool (https://taskfile.dev/) and acts as a modern
#  alternative to Makefiles — with cleaner syntax, native YAML support, and built-in shell integration.
#
#  These tasks are intended to:
#    - Simplify setup and usage for contributors
#    - Ensure consistent linting and testing across environments
#    - Act as automation hooks for CI pipelines or local workflows.
#
#  File generated by goboot — do not reuse blindly.
#  -----------------------------------------------------------------------------

version: "3"

#  -----------------------------------------------------------------------------
#  Setup
#  -----------------------------------------------------------------------------

vars:
  DOCKER_RUN: 'docker run --rm -v {{"{{.ROOT_DIR}}"}}:/workdir -w /workdir'
  SH_FILES:
    sh: find . -type f -name '*.sh' | tr '\n' ' '

#  -----------------------------------------------------------------------------
#  Defined Tasks
#  -----------------------------------------------------------------------------

{{- $linters := index .TaskScripts "base_lint" }}
{{- $tests := index .TaskScripts "base_test" }}
{{- if or $linters $tests }}
tasks:
  default:
    desc: Run default developer workflow
    deps:
      {{- if $linters }}
      - lint
      {{- end }}
      {{- if $tests }}
      - test
      {{- end }}

  {{- if $linters }}
  lint:
    desc: Run linters
    cmds:
      {{- range $cmd := $linters }}
      - |
{{ indent 10 (replace (replace $cmd "{{DOCKER_RUN}}" "{{.DOCKER_RUN}}") "{{SH_FILES}}" "{{.SH_FILES}}") }}
      {{- end }}
  {{- end }}

  {{- if $tests }}
  test:
    desc: Run tests
    cmds:
      - |
{{ indent 10 (index $tests 0) }}
  {{- end }}
{{- end }}
