#!/usr/bin/env bash
#  -----------------------------------------------------------------------------
#  Lint Script — Static Analysis for `{{ .ProjectName }}`
#  -----------------------------------------------------------------------------
#
#  It is intended to ensure consistent code quality across environments.
#
#  Linters are dynamically injected during scaffolding based on project config.
#
#  Usage:
#    ./scripts/lint.sh
#
#  Requirements:
#    - Depend on injections
#    - Docker only possible
#    - Or dedicated tools like shellcheck, shfmt, markdownlint, ...
#
#  File generated by goboot — do not reuse blindly.
#  -----------------------------------------------------------------------------

set -euo pipefail

# -----------------------------------------------------------------------------
# Setup
# -----------------------------------------------------------------------------
ROOT_DIR="$(pwd)"
DOCKER_RUN="docker run --rm -v ${ROOT_DIR}:/workdir -w /workdir"
SH_FILES="$(find . -type f -name '*.sh' | tr '\n' ' ')"

run() {
  local -r cmd="$1"
  echo "Running: ${cmd}"
  bash -lc "${cmd}"
  echo "✓ Done: ${cmd}"
  echo
}

# -----------------------------------------------------------------------------
# Execute Enabled Linters
# -----------------------------------------------------------------------------

echo "Starting lint process for '{{ .ProjectName }}'..."
echo ""

{{- $linters := index .TaskScripts "base_lint" }}
{{- if not $linters }}
echo "No linters are currently configured. Nothing to do."
exit 0
{{- else }}
{{- range $linter := $linters }}

run "{{ replace (replace $linter "{{DOCKER_RUN}}" "${DOCKER_RUN}") "{{SH_FILES}}" "${SH_FILES}" | oneLine }}"

{{- end }}

# -----------------------------------------------------------------------------
# Summary
# -----------------------------------------------------------------------------

echo "All configured linters completed successfully."
exit 0
{{- end }}
